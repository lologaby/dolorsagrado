---
import Layout from '../layouts/Layout.astro';

const gallery = [
  '/images/piercing-gallery-1.jpg',
  '/images/piercing-gallery-2.jpg',
  '/images/piercing-gallery-3.jpg',
  '/images/piercing-gallery-4.jpg',
  '/images/piercing-gallery-5.jpg',
  '/images/piercing-gallery-6.jpg',
];

/*
  3D Pieces — cada entry tiene:
    id:      slug único
    title:   nombre de la pieza
    style:   descripción del estilo
    model:   path al archivo .glb en /public/models/
    thumb:   imagen de preview (foto real del tatuaje)
    placeholder: true mientras no exista el .glb
*/
const pieces3d = [
  {
    id: 'sleeve-01',
    title: 'Sleeve Black & Grey',
    style: 'Full sleeve · Realismo oscuro',
    model: '/models/joshua-sleeve-01.glb',
    thumb: '/images/piercing-gallery-1.jpg',
    placeholder: true,
  },
  {
    id: 'forearm-02',
    title: 'Antebrazo Geométrico',
    style: 'Forearm · Blackwork + geometría',
    model: '/models/joshua-forearm-02.glb',
    thumb: '/images/piercing-gallery-2.jpg',
    placeholder: true,
  },
  {
    id: 'upper-arm-03',
    title: 'Brazo Superior · Retrato',
    style: 'Upper arm · Retrato Black & Grey',
    model: '/models/joshua-upper-arm-03.glb',
    thumb: '/images/piercing-gallery-3.jpg',
    placeholder: true,
  },
  {
    id: 'calf-04',
    title: 'Pantorrilla Floral',
    style: 'Calf · Botanical · Dotwork',
    model: '/models/joshua-calf-04.glb',
    thumb: '/images/piercing-gallery-4.jpg',
    placeholder: true,
  },
];
---

<Layout
  title="Joshua Reyes — Piezas 3D · Sacred Pain Tattoo"
  description="Explora las piezas de Joshua Reyes en 3D. Brazos modelados en Blender con sus tatuajes. Rota, examina, descubre el arte."
>
  <!-- ═══════════════════════════════════ HERO -->
  <section class="artist-hero">
    <div class="artist-hero-bg">
      <img src="/images/piercing-gallery-2.jpg" alt="" aria-hidden="true" />
      <div class="artist-hero-overlay"></div>
    </div>
    <div class="container artist-hero-content fade-in">
      <div class="artist-meta">
        <p class="kicker">Sacred Pain · San Juan, PR</p>
        <h1 class="h1">Joshua Reyes</h1>
        <p class="artist-specialty">Black &amp; Grey · Arte en la piel</p>
        <p class="artist-handle">
          <a href="https://www.instagram.com/jousoytuartista" target="_blank" rel="noreferrer">@jousoytuartista</a>
        </p>
        <div class="artist-ctas">
          <a class="btn btn-gold" href="/reservar">Reservar cita</a>
          <a class="btn btn-outline-gold" href="https://www.instagram.com/jousoytuartista" target="_blank" rel="noreferrer">Instagram</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ═══════════════════════════════ 3D VIEWER SECTION -->
  <section class="section-3d" id="piezas-3d">
    <div class="container-3d">

      <!-- Section header -->
      <div class="s3d-header fade-in">
        <p class="kicker">Experiencia inmersiva</p>
        <h2 class="h2">Piezas en <span class="gold-text">3D</span></h2>
        <p class="lead s3d-lead">
          Cada tatuaje de Joshua modelado en Blender. Rota, acerca y examina
          cada detalle como si lo tuvieras en frente.
        </p>
        <div class="s3d-controls-hint">
          <span><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg> Arrastrar · Rotar</span>
          <span><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 3l-9 9M3 21l9-9M14 3h7v7M10 21H3v-7"/></svg> Pellizcar · Zoom</span>
          <span><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3"/></svg> Click derecho · Pan</span>
        </div>
      </div>

      <!-- Piece selector tabs -->
      <div class="s3d-tabs fade-in" role="tablist" aria-label="Selecciona una pieza 3D">
        {pieces3d.map((p, i) => (
          <button
            class={`s3d-tab${i === 0 ? ' s3d-tab--active' : ''}`}
            role="tab"
            aria-selected={i === 0 ? 'true' : 'false'}
            data-piece={p.id}
            data-model={p.model}
            data-placeholder={p.placeholder ? 'true' : 'false'}
            aria-label={p.title}
          >
            <div class="s3d-tab-thumb">
              <img src={p.thumb} alt={p.title} loading="lazy" />
              <div class="s3d-tab-badge">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                3D
              </div>
            </div>
            <div class="s3d-tab-info">
              <span class="s3d-tab-title">{p.title}</span>
              <span class="s3d-tab-style">{p.style}</span>
            </div>
          </button>
        ))}
      </div>

      <!-- 3D Canvas -->
      <div class="s3d-viewer-wrap fade-in">
        <canvas id="canvas-3d" class="s3d-canvas" aria-label="Viewer 3D interactivo"></canvas>

        <!-- Loading overlay -->
        <div class="s3d-loading" id="s3d-loading">
          <div class="s3d-spinner"></div>
          <p>Cargando modelo 3D…</p>
        </div>

        <!-- Preview badge (while real .glb is pending) -->
        <div class="s3d-placeholder" id="s3d-placeholder">
          <div class="s3d-placeholder-inner">
            <p class="s3d-placeholder-title">
              <svg width="11" height="11" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
              Preview · Modelo final en Blender próximamente
            </p>
          </div>
        </div>

        <!-- Viewer UI overlay -->
        <div class="s3d-ui" id="s3d-ui">
          <div class="s3d-piece-name" id="s3d-piece-name"></div>
          <div class="s3d-actions">
            <button class="s3d-btn" id="btn-reset" title="Resetear cámara">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            </button>
            <button class="s3d-btn" id="btn-autorotate" title="Auto-rotación" class="active">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/></svg>
            </button>
            <button class="s3d-btn" id="btn-fullscreen" title="Pantalla completa">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
            </button>
          </div>
        </div>
      </div>

      <!-- CTA under viewer -->
      <div class="s3d-cta fade-in">
        <p class="s3d-cta-text">
          ¿Quieres un diseño personalizado de Joshua?
        </p>
        <a class="btn btn-gold" href="/reservar">Reservar con Joshua</a>
        <a class="btn" href="https://www.instagram.com/jousoytuartista" target="_blank" rel="noreferrer">Ver Instagram</a>
      </div>
    </div>
  </section>

  <hr class="divider" />

  <!-- ══════════════════════════════════════════════ BIO -->
  <section class="section">
    <div class="container bio-grid fade-in">
      <div>
        <p class="kicker">Sobre el artista</p>
        <h2 class="h2">Black &amp; Grey<br/>con carácter</h2>
      </div>
      <div class="bio-text">
        <p class="lead">
          Joshua Reyes es parte del equipo de Sacred Pain Tattoo.
          Su especialidad en <strong>Black &amp; Grey</strong> le permite crear piezas
          con alto contraste, texturas detalladas y una profundidad visual que marca la piel
          con intención y permanencia.
        </p>
        <p class="lead" style="margin-top:16px">
          Pionero en presentar su trabajo en formato 3D interactivo — cada pieza modelada en Blender
          para que puedas ver el tatuaje desde todos los ángulos antes de decidir.
        </p>
        <div style="margin-top:24px;display:flex;gap:10px;flex-wrap:wrap">
          <a class="btn btn-gold" href="/reservar">Reservar cita</a>
          <a class="btn btn-outline-gold" href="https://www.instagram.com/jousoytuartista" target="_blank" rel="noreferrer">Instagram</a>
        </div>
      </div>
    </div>
  </section>

  <hr class="divider" />

  <!-- ══════════════════════════════════════ GALERÍA FOTOS -->
  <section class="gallery-section">
    <div class="container fade-in" style="padding-bottom:32px">
      <p class="kicker">Portfolio fotográfico</p>
      <h2 class="h2">El arte de Joshua</h2>
    </div>
    <div class="artist-gallery-grid">
      {gallery.map((img, i) => (
        <a
          class={`ag-item${i === 0 ? ' ag-item--tall' : ''}`}
          href="https://www.instagram.com/jousoytuartista"
          target="_blank"
          rel="noreferrer"
          aria-label="Ver en Instagram"
        >
          <img src={img} alt="Tatuaje por Joshua Reyes" loading="lazy" />
          <div class="ag-overlay"><span>↗</span></div>
        </a>
      ))}
    </div>
    <div class="container" style="padding-top:28px;text-align:center">
      <a class="btn btn-outline-gold" href="https://www.instagram.com/jousoytuartista" target="_blank" rel="noreferrer">
        Ver portafolio completo en Instagram
      </a>
    </div>
  </section>

  <hr class="divider" />

  <!-- ═══════════════════════════ RESERVAR CTA -->
  <section class="section-sm">
    <div class="container">
      <div class="artist-cta-block card fade-in">
        <div>
          <p class="kicker">¿Listo para tu pieza?</p>
          <h2 class="h2">Reserva con Joshua</h2>
          <p class="lead">Cuéntanos tu idea y coordinamos la sesión.</p>
        </div>
        <div class="artist-cta-btns">
          <a class="btn btn-gold" href="/reservar">Reservar cita</a>
          <a class="btn" href="tel:7875962562">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 16.92V20a2 2 0 0 1-2.18 2A19.79 19.79 0 0 1 4.37 6.18 2 2 0 0 1 6.36 4h3.08a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L10.91 11.4a16 16 0 0 0 6.69 6.69l.78-.78a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
            Llamar al estudio
          </a>
        </div>
      </div>
    </div>
  </section>

  <hr class="divider" />

  <!-- ═══════════════════════════ AFTERCARE -->
  <section class="section aftercare-section">
    <div class="container fade-in">
      <p class="kicker">Cuidado posterior</p>
      <h2 class="h2">Aftercare del tatuaje</h2>
      <p class="lead" style="margin-bottom:32px">
        El cuidado post-tatuaje es tan importante como la sesión misma.
      </p>
      <div class="aftercare-grid">
        <div class="aftercare-card card"><div class="card-body">
          <p class="aftercare-num">01</p>
          <h3 class="h3">Primeras 24 horas</h3>
          <p>Mantén el vendaje 2–4 horas. Lava con agua tibia y jabón sin fragancia.</p>
        </div></div>
        <div class="aftercare-card card"><div class="card-body">
          <p class="aftercare-num">02</p>
          <h3 class="h3">Días 2–7</h3>
          <p>Aplica Lubriderm o Aquaphor 2–3 veces al día. Evita remojar en agua.</p>
        </div></div>
        <div class="aftercare-card card"><div class="card-body">
          <p class="aftercare-num">03</p>
          <h3 class="h3">Semanas 2–4</h3>
          <p>No arranques la piel. Hidrata diario. Evita sol y piscina hasta sanar.</p>
        </div></div>
        <div class="aftercare-card card"><div class="card-body">
          <p class="aftercare-num">04</p>
          <h3 class="h3">Lo que debes evitar</h3>
          <p>Rascarte, sol directo, nadar, ropa ajustada, cremas con alcohol o fragancia.</p>
        </div></div>
      </div>
    </div>
  </section>
</Layout>

<!-- ─── Three.js 3D Viewer Script ─────────────────────────────── -->
<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.167.1/examples/jsm/controls/OrbitControls.js';
import { GLTFLoader }    from 'https://cdn.jsdelivr.net/npm/three@0.167.1/examples/jsm/loaders/GLTFLoader.js';
import { DRACOLoader }   from 'https://cdn.jsdelivr.net/npm/three@0.167.1/examples/jsm/loaders/DRACOLoader.js';

/* ── DOM ───────────────────────────────────────────── */
const canvas        = document.getElementById('canvas-3d');
const loadingEl     = document.getElementById('s3d-loading');
const placeholderEl = document.getElementById('s3d-placeholder');
const uiEl          = document.getElementById('s3d-ui');
const pieceNameEl   = document.getElementById('s3d-piece-name');
const btnReset      = document.getElementById('btn-reset');
const btnAuto       = document.getElementById('btn-autorotate');
const btnFS         = document.getElementById('btn-fullscreen');
const tabs          = document.querySelectorAll('.s3d-tab');
const wrap          = document.querySelector('.s3d-viewer-wrap');

/* ── Renderer ──────────────────────────────────────── */
const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
renderer.outputColorSpace  = THREE.SRGBColorSpace;
renderer.shadowMap.enabled = true;
renderer.shadowMap.type    = THREE.PCFSoftShadowMap;
renderer.toneMapping       = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.35;

const scene  = new THREE.Scene();
scene.background = new THREE.Color(0x0a0809);
scene.fog = new THREE.FogExp2(0x0a0809, 0.18);

const camera = new THREE.PerspectiveCamera(42, 1, 0.01, 50);
camera.position.set(0, 0.12, 2.6);

/* ── Lights ────────────────────────────────────────── */
scene.add(new THREE.AmbientLight(0xfff3e0, 0.50));

const key = new THREE.DirectionalLight(0xfff0d8, 2.8);
key.position.set(1.8, 3, 2.5);
key.castShadow = true;
key.shadow.mapSize.set(2048, 2048);
key.shadow.camera.near = 0.5; key.shadow.camera.far = 12;
key.shadow.camera.left = -2;  key.shadow.camera.right = 2;
key.shadow.camera.top  =  2;  key.shadow.camera.bottom = -2;
scene.add(key);

const fill = new THREE.DirectionalLight(0x8ab0cc, 0.55);
fill.position.set(-2.5, 0.5, 1);
scene.add(fill);

const rim = new THREE.DirectionalLight(0xc49a47, 0.9);
rim.position.set(0.3, -1.5, -2.5);
scene.add(rim);

// Subtle point light below — uplight
const up = new THREE.PointLight(0xff9955, 0.25, 6);
up.position.set(0, -1.5, 0.5);
scene.add(up);

// Floor grid
const grid = new THREE.GridHelper(8, 28, 0x1c1618, 0x161214);
grid.position.y = -1.05;
scene.add(grid);

/* ── Controls ──────────────────────────────────────── */
const controls = new OrbitControls(camera, canvas);
controls.enableDamping  = true;
controls.dampingFactor  = 0.06;
controls.minDistance    = 0.8;
controls.maxDistance    = 4.5;
controls.autoRotate     = true;
controls.autoRotateSpeed = 1.5;
controls.target.set(0, 0, 0);

/* ── GLTF / DRACO ──────────────────────────────────── */
const draco = new DRACOLoader();
draco.setDecoderPath('https://cdn.jsdelivr.net/npm/three@0.167.1/examples/jsm/libs/draco/');
const gltf = new GLTFLoader();
gltf.setDRACOLoader(draco);

/* ══════════════════════════════════════════════════════
   PROCEDURAL ARM BUILDER
   Creates a convincing anatomical arm with:
   - Shoulder cap, bicep, tricep bulge
   - Elbow joint
   - Forearm with pronator taper
   - Wrist and hand with thumb + 4 fingers
   - Canvas-painted tattoo texture overlaid on skin
   ══════════════════════════════════════════════════════ */

function buildArm(tattooStyle = 0) {
  const group = new THREE.Group();

  /* ── Skin material ── */
  const skinColor  = new THREE.Color(0x9a7055);   // medium-warm latino skin
  const skinRough  = 0.70;

  function skin(color = skinColor) {
    return new THREE.MeshStandardMaterial({
      color,
      roughness: skinRough,
      metalness: 0.0,
    });
  }

  /* ── Helper: smooth cylinder with end-sphere joints ── */
  function limbSegment(rTop, rBot, height, y, mat) {
    const g = new THREE.Group();
    const cyl = new THREE.Mesh(new THREE.CylinderGeometry(rTop, rBot, height, 28, 4, false), mat);
    cyl.castShadow = cyl.receiveShadow = true;
    g.add(cyl);
    const capT = new THREE.Mesh(new THREE.SphereGeometry(rTop, 20, 12), mat);
    capT.position.y =  height / 2;
    capT.castShadow = true;
    g.add(capT);
    const capB = new THREE.Mesh(new THREE.SphereGeometry(rBot, 20, 12), mat);
    capB.position.y = -height / 2;
    capB.castShadow = true;
    g.add(capB);
    g.position.y = y;
    return g;
  }

  /* ── Shoulder cap ── */
  const shoulder = new THREE.Mesh(
    new THREE.SphereGeometry(0.165, 28, 18),
    skin(new THREE.Color(0x9a7055))
  );
  shoulder.scale.set(1, 1.1, 0.9);
  shoulder.position.y = 0.72;
  shoulder.castShadow = true;
  group.add(shoulder);

  /* ── Upper arm: bicep/tricep implied by slight ovoid + taper ── */
  const upperArm = limbSegment(0.140, 0.118, 0.60, 0.36, skin());
  // Bicep bulge
  const bicep = new THREE.Mesh(
    new THREE.SphereGeometry(0.145, 20, 14),
    skin()
  );
  bicep.scale.set(0.9, 1.15, 0.78);
  bicep.position.set(0.02, 0.52, 0.06);
  bicep.castShadow = true;
  group.add(bicep);
  group.add(upperArm);

  /* ── Elbow ── */
  const elbow = new THREE.Mesh(new THREE.SphereGeometry(0.115, 24, 16), skin());
  elbow.scale.set(1, 0.88, 0.95);
  elbow.castShadow = true;
  group.add(elbow);

  /* ── Forearm: tapers more aggressively ── */
  const forearm = limbSegment(0.108, 0.082, 0.58, -0.30, skin());
  // Extensor muscle bulge on back of forearm
  const ext = new THREE.Mesh(
    new THREE.SphereGeometry(0.098, 16, 12),
    skin()
  );
  ext.scale.set(0.85, 1.4, 0.7);
  ext.position.set(-0.015, -0.18, -0.04);
  ext.castShadow = true;
  group.add(ext);
  group.add(forearm);

  /* ── Wrist ── */
  const wrist = new THREE.Mesh(new THREE.SphereGeometry(0.080, 22, 14), skin());
  wrist.scale.set(1.05, 0.80, 0.88);
  wrist.position.y = -0.605;
  wrist.castShadow = true;
  group.add(wrist);

  /* ── Palm ── */
  const palm = new THREE.Mesh(
    new THREE.BoxGeometry(0.150, 0.180, 0.068),
    skin()
  );
  palm.geometry = new THREE.CylinderGeometry(0.075, 0.075, 0.18, 10, 1, false);
  // actually use a flattened sphere for organic feel
  palm.geometry = new THREE.SphereGeometry(0.09, 20, 14);
  palm.scale.set(1.5, 1.9, 0.72);
  palm.position.y = -0.770;
  palm.castShadow = true;
  group.add(palm);

  /* ── Fingers ── (4 fingers + thumb, simplified capsule) ── */
  function finger(rx, ry, rz, len, x, y, z) {
    const fg = new THREE.Group();
    const f = new THREE.Mesh(
      new THREE.CapsuleGeometry(0.016, len, 6, 10),
      skin(new THREE.Color(0x8f6848))
    );
    f.castShadow = true;
    fg.add(f);
    fg.rotation.set(rx, ry, rz);
    fg.position.set(x, y, z);
    return fg;
  }
  const fingerData = [
    { x: -0.055, len: 0.10, rz: -0.08 },
    { x: -0.018, len: 0.12, rz: -0.02 },
    { x:  0.018, len: 0.11, rz:  0.02 },
    { x:  0.055, len: 0.09, rz:  0.08 },
  ];
  fingerData.forEach(d => {
    const f = finger(0, 0, d.rz, d.len, d.x, -0.91 - d.len / 2, 0);
    group.add(f);
  });
  // Thumb — angled out
  const thumb = finger(-0.3, 0, -0.9, 0.075, -0.10, -0.77, 0.03);
  group.add(thumb);

  /* ══════════════════════════════════════════════
     TATTOO TEXTURE — painted on canvas, projected
     Each tattooStyle (0-3) draws a different design
     ═════════════════════════════════════════════= */

  const texSize = 512;
  const tc = document.createElement('canvas');
  tc.width = tc.height = texSize;
  const ctx = tc.getContext('2d');

  // Clear transparent
  ctx.clearRect(0, 0, texSize, texSize);

  const styles = [
    drawBlackGrey,
    drawGeometric,
    drawPortrait,
    drawDotwork,
  ];
  styles[tattooStyle % styles.length](ctx, texSize);

  const tattooTex = new THREE.CanvasTexture(tc);

  /* Tattoo is an overlapping cylinder (slightly larger radius) */
  const tattooGeo = new THREE.CylinderGeometry(0.112, 0.086, 0.54, 28, 1, true);
  const tattooMat = new THREE.MeshStandardMaterial({
    map:         tattooTex,
    transparent: true,
    alphaTest:   0.02,
    roughness:   0.85,
    metalness:   0.0,
    depthWrite:  false,
    side:        THREE.FrontSide,
  });
  const tattoo = new THREE.Mesh(tattooGeo, tattooMat);
  tattoo.position.y = -0.30;
  tattoo.renderOrder = 1;
  group.add(tattoo);

  /* Slight global rotation so arm is angled naturally */
  group.rotation.x = 0.18;
  group.rotation.z = 0.06;

  return group;
}

/* ── Tattoo drawing functions ───────────────────────── */

function drawBlackGrey(ctx, s) {
  // Skull + roses sleeve - very B&G
  // Background wash
  ctx.fillStyle = 'rgba(10,8,10,0.0)';
  ctx.fillRect(0, 0, s, s);

  // Dark ink wash base
  const grd = ctx.createLinearGradient(0, 0, s, s);
  grd.addColorStop(0, 'rgba(18,14,18,0.72)');
  grd.addColorStop(0.5, 'rgba(30,20,25,0.55)');
  grd.addColorStop(1, 'rgba(10,8,10,0.68)');
  ctx.fillStyle = grd;
  ctx.fillRect(0, 0, s, s);

  // Skull shape
  ctx.fillStyle = 'rgba(220,210,205,0.88)';
  ctx.beginPath();
  ctx.ellipse(s*0.5, s*0.28, s*0.14, s*0.16, 0, 0, Math.PI*2);
  ctx.fill();

  // Skull highlights
  ctx.fillStyle = 'rgba(255,248,240,0.6)';
  ctx.beginPath();
  ctx.ellipse(s*0.47, s*0.24, s*0.055, s*0.06, -0.3, 0, Math.PI*2);
  ctx.fill();

  // Eye sockets
  ctx.fillStyle = 'rgba(12,8,12,0.95)';
  ctx.beginPath(); ctx.ellipse(s*0.44, s*0.28, s*0.038, s*0.032, 0, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.ellipse(s*0.56, s*0.28, s*0.038, s*0.032, 0, 0, Math.PI*2); ctx.fill();

  // Nose
  ctx.beginPath(); ctx.moveTo(s*0.50, s*0.32); ctx.lineTo(s*0.47, s*0.35); ctx.lineTo(s*0.53, s*0.35); ctx.closePath();
  ctx.fillStyle = 'rgba(12,8,12,0.85)'; ctx.fill();

  // Rose — left
  drawRose(ctx, s*0.22, s*0.55, s*0.10);
  // Rose — right
  drawRose(ctx, s*0.78, s*0.55, s*0.09);
  // Rose — bottom center
  drawRose(ctx, s*0.50, s*0.76, s*0.11);

  // Flowing lines
  ctx.strokeStyle = 'rgba(180,160,150,0.55)';
  ctx.lineWidth = 1.5;
  for (let i = 0; i < 8; i++) {
    ctx.beginPath();
    ctx.moveTo(Math.random()*s, 0);
    ctx.bezierCurveTo(Math.random()*s, s*0.3, Math.random()*s, s*0.7, Math.random()*s, s);
    ctx.stroke();
  }

  // Shading stipple
  ctx.fillStyle = 'rgba(8,6,8,0.06)';
  for (let i = 0; i < 1200; i++) {
    const x = Math.random()*s, y = Math.random()*s;
    ctx.beginPath(); ctx.arc(x, y, Math.random()*1.5, 0, Math.PI*2); ctx.fill();
  }
}

function drawRose(ctx, cx, cy, r) {
  ctx.save();
  ctx.translate(cx, cy);
  // Petals
  const petals = 12;
  for (let i = 0; i < petals; i++) {
    const a = (i / petals) * Math.PI * 2;
    const pr = r * (0.45 + 0.3 * Math.sin(i * 2.1));
    ctx.fillStyle = `rgba(${30 + i*8},${18 + i*5},${22 + i*4},${0.75 - i*0.03})`;
    ctx.beginPath();
    ctx.ellipse(Math.cos(a)*r*0.38, Math.sin(a)*r*0.38, pr*0.55, pr*0.35, a, 0, Math.PI*2);
    ctx.fill();
  }
  // Center
  ctx.fillStyle = 'rgba(15,10,15,0.9)';
  ctx.beginPath(); ctx.arc(0, 0, r*0.18, 0, Math.PI*2); ctx.fill();
  ctx.restore();
}

function drawGeometric(ctx, s) {
  // Sacred geometry / mandalas / blackwork

  ctx.fillStyle = 'rgba(5,4,6,0.65)';
  ctx.fillRect(0, 0, s, s);

  // Mandala center
  const cx = s*0.5, cy = s*0.38;
  const rings = [s*0.20, s*0.28, s*0.35, s*0.40];
  ctx.strokeStyle = 'rgba(228,218,210,0.90)';

  rings.forEach((r, ri) => {
    const segs = 6 + ri * 6;
    ctx.lineWidth = ri === 0 ? 2.5 : 1.0 - ri*0.1;
    ctx.beginPath();
    for (let i = 0; i <= segs; i++) {
      const a = (i / segs) * Math.PI * 2;
      i === 0 ? ctx.moveTo(cx + Math.cos(a)*r, cy + Math.sin(a)*r)
              : ctx.lineTo(cx + Math.cos(a)*r, cy + Math.sin(a)*r);
    }
    ctx.closePath(); ctx.stroke();
  });

  // Star of David / hex pattern
  for (let i = 0; i < 6; i++) {
    const a = (i / 6) * Math.PI * 2 - Math.PI / 6;
    ctx.strokeStyle = 'rgba(200,188,178,0.80)';
    ctx.lineWidth = 1.2;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(cx + Math.cos(a)*s*0.40, cy + Math.sin(a)*s*0.40);
    ctx.stroke();
    // small diamonds
    const bx = cx + Math.cos(a)*s*0.26, by = cy + Math.sin(a)*s*0.26;
    ctx.beginPath();
    ctx.moveTo(bx, by - s*0.04);
    ctx.lineTo(bx + s*0.03, by);
    ctx.lineTo(bx, by + s*0.04);
    ctx.lineTo(bx - s*0.03, by);
    ctx.closePath();
    ctx.fillStyle = 'rgba(210,195,180,0.70)'; ctx.fill();
  }

  // Triangle overlays
  ctx.strokeStyle = 'rgba(255,245,235,0.50)'; ctx.lineWidth = 1.5;
  [[s*.5,s*.05, s*.15,s*.48, s*.85,s*.48],
   [s*.5,s*.48, s*.15,s*.05, s*.85,s*.05]].forEach(([x1,y1,x2,y2,x3,y3]) => {
    ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.lineTo(x3,y3); ctx.closePath(); ctx.stroke();
  });

  // Bottom half: repeating chevron lines
  ctx.strokeStyle = 'rgba(190,175,160,0.55)'; ctx.lineWidth = 1;
  for (let row = 0; row < 10; row++) {
    const y = s*0.58 + row*s*0.042;
    ctx.beginPath();
    for (let xi = 0; xi <= 16; xi++) {
      const xp = (xi/16)*s;
      const yp = y + Math.sin((xi/16)*Math.PI*4)*s*0.012;
      xi === 0 ? ctx.moveTo(xp, yp) : ctx.lineTo(xp, yp);
    }
    ctx.stroke();
  }
}

function drawPortrait(ctx, s) {
  // B&G portrait — Dia de los Muertos / Calavera style

  ctx.fillStyle = 'rgba(8,6,10,0.55)';
  ctx.fillRect(0, 0, s, s);

  // Face oval
  const grd = ctx.createRadialGradient(s*.5, s*.32, s*.02, s*.5, s*.32, s*.22);
  grd.addColorStop(0, 'rgba(235,220,205,0.92)');
  grd.addColorStop(0.6, 'rgba(195,178,160,0.78)');
  grd.addColorStop(1, 'rgba(140,118,95,0.0)');
  ctx.fillStyle = grd;
  ctx.beginPath();
  ctx.ellipse(s*.5, s*.32, s*.18, s*.23, 0, 0, Math.PI*2);
  ctx.fill();

  // Calavera floral eye L
  ctx.strokeStyle = 'rgba(18,12,20,0.95)'; ctx.lineWidth = 1.5;
  for (let p = 0; p < 7; p++) {
    const a = (p/7)*Math.PI*2;
    ctx.beginPath();
    ctx.ellipse(s*.41 + Math.cos(a)*s*.04, s*.28 + Math.sin(a)*s*.04, s*.018, s*.010, a, 0, Math.PI*2);
    ctx.stroke();
  }
  // Calavera floral eye R
  for (let p = 0; p < 7; p++) {
    const a = (p/7)*Math.PI*2;
    ctx.beginPath();
    ctx.ellipse(s*.59 + Math.cos(a)*s*.04, s*.28 + Math.sin(a)*s*.04, s*.018, s*.010, a, 0, Math.PI*2);
    ctx.stroke();
  }

  // Nose
  ctx.beginPath(); ctx.moveTo(s*.5, s*.33); ctx.lineTo(s*.46, s*.38); ctx.lineTo(s*.54, s*.38); ctx.closePath();
  ctx.fillStyle = 'rgba(20,14,22,0.75)'; ctx.fill();

  // Stitched smile
  ctx.strokeStyle = 'rgba(15,10,18,0.90)'; ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.arc(s*.5, s*.40, s*.085, Math.PI*0.05, Math.PI*0.95);
  ctx.stroke();
  for (let t = 0; t < 6; t++) {
    const a = Math.PI*0.12 + t*(Math.PI*0.75/5);
    const px = s*.5 + Math.cos(a)*s*.085, py = s*.40 + Math.sin(a)*s*.085;
    ctx.beginPath(); ctx.moveTo(px, py - s*.012); ctx.lineTo(px, py + s*.012); ctx.stroke();
  }

  // Floral halo
  ctx.strokeStyle = 'rgba(200,185,165,0.55)'; ctx.lineWidth = 1;
  for (let i = 0; i < 18; i++) {
    const a = (i/18)*Math.PI*2;
    ctx.beginPath();
    ctx.ellipse(s*.5 + Math.cos(a)*s*.22, s*.32 + Math.sin(a)*s*.22, s*.04, s*.025, a, 0, Math.PI*2);
    ctx.stroke();
  }

  // Lower decorative bands
  ctx.fillStyle = 'rgba(12,9,14,0.55)';
  for (let b = 0; b < 5; b++) {
    ctx.fillRect(0, s*(.62 + b*.072), s, s*.030);
  }
  ctx.fillStyle = 'rgba(200,180,155,0.25)';
  for (let b = 0; b < 5; b++) {
    ctx.fillRect(s*.05, s*(.635 + b*.072), s*.9, s*.012);
  }
}

function drawDotwork(ctx, s) {
  // Dotwork botanical / mandala

  ctx.fillStyle = 'rgba(6,5,8,0.60)';
  ctx.fillRect(0, 0, s, s);

  // Central botanical — lotus / flower
  const cx = s*.5, cy = s*.35;

  // Large petals
  for (let i = 0; i < 8; i++) {
    const a = (i/8)*Math.PI*2 - Math.PI/8;
    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(a);
    ctx.fillStyle = 'rgba(220,205,190,0.25)';
    ctx.beginPath();
    ctx.ellipse(0, -s*.16, s*.05, s*.14, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.strokeStyle = 'rgba(200,185,168,0.60)'; ctx.lineWidth = 0.8;
    ctx.stroke();
    ctx.restore();
  }

  // Dot stipple — fills the arm in a botanical pattern
  const stipple = (x, y, r, density, alpha) => {
    for (let i = 0; i < density; i++) {
      const a2 = Math.random()*Math.PI*2;
      const d = Math.random()*r;
      const px = x + Math.cos(a2)*d, py = y + Math.sin(a2)*d;
      const sz = Math.random()*1.8 + 0.3;
      ctx.fillStyle = `rgba(215,200,182,${alpha * (0.5 + Math.random()*0.5)})`;
      ctx.beginPath(); ctx.arc(px, py, sz, 0, Math.PI*2); ctx.fill();
    }
  };

  stipple(cx, cy, s*.38, 1800, 0.55);

  // Concentric dot rings
  for (let ring = 1; ring <= 5; ring++) {
    const r = ring * s*.07;
    const count = ring * 12;
    for (let d = 0; d < count; d++) {
      const a = (d/count)*Math.PI*2;
      const sz = ring < 3 ? 1.8 : 1.2;
      ctx.fillStyle = `rgba(210,195,175,${0.7 - ring*0.08})`;
      ctx.beginPath();
      ctx.arc(cx + Math.cos(a)*r, cy + Math.sin(a)*r, sz, 0, Math.PI*2);
      ctx.fill();
    }
  }

  // Stem with leaves
  ctx.strokeStyle = 'rgba(190,175,158,0.65)'; ctx.lineWidth = 1.5;
  ctx.beginPath(); ctx.moveTo(cx, s*.48); ctx.lineTo(cx, s*.95); ctx.stroke();
  [[s*.5, s*.60, 18, -28], [s*.5, s*.70, -18, 28],
   [s*.5, s*.80, 15, -22]].forEach(([x, y, lx, ly]) => {
    ctx.beginPath(); ctx.moveTo(x, y); ctx.quadraticCurveTo(x+lx, y-8, x+lx, y+ly); ctx.stroke();
    stipple(x + lx/2, y + ly/3, s*.06, 150, 0.45);
  });
}

/* ── State ─────────────────────────────────────────── */
let currentModel = null;
let autoRotate   = true;

/* ── Resize ────────────────────────────────────────── */
function resize() {
  const w = wrap.clientWidth, h = wrap.clientHeight;
  renderer.setSize(w, h, false);
  camera.aspect = w / h;
  camera.updateProjectionMatrix();
}
new ResizeObserver(resize).observe(wrap);

/* ── Load piece ────────────────────────────────────── */
function loadPiece(modelPath, title, isPlaceholder, tattooIdx) {
  if (currentModel) { scene.remove(currentModel); currentModel = null; }
  pieceNameEl.textContent = title;

  const idx = parseInt(tattooIdx ?? 0);

  if (isPlaceholder) {
    placeholderEl.style.display = 'flex';
    uiEl.style.opacity = '1';
    loadingEl.style.display = 'none';
    const arm = buildArm(idx);
    currentModel = arm;
    scene.add(arm);
    return;
  }

  placeholderEl.style.display = 'none';
  uiEl.style.opacity = '1';
  loadingEl.style.display = 'flex';

  gltf.load(
    modelPath,
    (data) => {
      loadingEl.style.display = 'none';
      const model = data.scene;
      const box   = new THREE.Box3().setFromObject(model);
      const size  = box.getSize(new THREE.Vector3());
      const center= box.getCenter(new THREE.Vector3());
      const scale = 1.6 / Math.max(size.x, size.y, size.z);
      model.scale.setScalar(scale);
      model.position.sub(center.multiplyScalar(scale));
      model.traverse(c => { if (c.isMesh) { c.castShadow = c.receiveShadow = true; } });
      currentModel = model;
      scene.add(model);
      controls.reset();
    },
    null,
    () => {
      loadingEl.style.display = 'none';
      placeholderEl.style.display = 'flex';
      const arm = buildArm(idx);
      currentModel = arm;
      scene.add(arm);
    }
  );
}

/* ── Tabs ──────────────────────────────────────────── */
tabs.forEach((tab, idx) => {
  tab.dataset.idx = idx;
  tab.addEventListener('click', () => {
    tabs.forEach(t => { t.classList.remove('s3d-tab--active'); t.setAttribute('aria-selected', 'false'); });
    tab.classList.add('s3d-tab--active');
    tab.setAttribute('aria-selected', 'true');
    loadPiece(
      tab.dataset.model,
      tab.querySelector('.s3d-tab-title').textContent,
      tab.dataset.placeholder === 'true',
      tab.dataset.idx
    );
  });
});

btnReset.addEventListener('click', () => { controls.reset(); camera.position.set(0, 0.12, 2.6); });
btnAuto.addEventListener('click', () => {
  autoRotate = !autoRotate;
  controls.autoRotate = autoRotate;
  btnAuto.classList.toggle('s3d-btn--active', autoRotate);
});
btnFS.addEventListener('click', () => {
  if (!document.fullscreenElement) wrap.requestFullscreen?.().catch(()=>{});
  else document.exitFullscreen?.();
});

/* ── Render loop ───────────────────────────────────── */
(function animate() {
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene, camera);
})();

/* ── Boot ──────────────────────────────────────────── */
resize();
if (tabs[0]) {
  tabs[0].dataset.idx = '0';
  loadPiece(tabs[0].dataset.model, tabs[0].querySelector('.s3d-tab-title').textContent, tabs[0].dataset.placeholder === 'true', 0);
  btnAuto.classList.add('s3d-btn--active');
}
</script>

<style>
  /* ── Artist hero ──────────────────────────────────── */
  .artist-hero {
    position: relative;
    min-height: 60vh;
    display: flex;
    align-items: flex-end;
    padding-bottom: 52px;
  }
  .artist-hero-bg { position: absolute; inset: 0; overflow: hidden; }
  .artist-hero-bg img { width: 100%; height: 100%; object-fit: cover; object-position: center; filter: brightness(0.42); }
  .artist-hero-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(7,6,8,0.97) 0%, rgba(7,6,8,0.25) 65%, transparent 100%); }
  .artist-hero-content { position: relative; z-index: 1; }
  .artist-meta h1 { margin: 8px 0 4px; }
  .artist-specialty { font-family: var(--font-heading); font-style: italic; font-size: 18px; color: var(--gold-lt); margin-bottom: 4px; }
  .artist-handle { font-size: 13px; color: var(--muted); margin-bottom: 20px; }
  .artist-handle a { color: var(--gold); }
  .artist-ctas { display: flex; gap: 10px; flex-wrap: wrap; }

  /* ── 3D Section ───────────────────────────────────── */
  .section-3d {
    background: #050405;
    padding: 72px 0 64px;
  }
  .container-3d {
    width: 100%;
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 20px;
  }
  .gold-text { color: var(--gold); }

  .s3d-header { margin-bottom: 36px; }
  .s3d-lead { max-width: 48ch; margin-top: 12px; }

  .s3d-controls-hint {
    display: flex;
    gap: 20px;
    margin-top: 16px;
    flex-wrap: wrap;
  }
  .s3d-controls-hint span {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.8px;
    color: var(--muted2);
    text-transform: uppercase;
  }
  .s3d-controls-hint svg { color: var(--gold); flex-shrink: 0; }

  /* ── Piece tabs ───────────────────────────────────── */
  .s3d-tabs {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    scrollbar-width: none;
    padding-bottom: 4px;
    margin-bottom: 20px;
  }
  .s3d-tabs::-webkit-scrollbar { display: none; }

  .s3d-tab {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px 10px 10px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: border-color 0.18s, background 0.18s, transform 0.15s;
    flex-shrink: 0;
    max-width: 220px;
    text-align: left;
    -webkit-tap-highlight-color: transparent;
  }
  .s3d-tab:hover { border-color: rgba(185,138,55,0.35); background: rgba(185,138,55,0.04); }
  .s3d-tab--active {
    border-color: var(--gold);
    background: rgba(185,138,55,0.08);
    box-shadow: 0 0 0 1px rgba(185,138,55,0.2);
  }

  .s3d-tab-thumb {
    position: relative;
    width: 52px; height: 52px;
    border-radius: 6px;
    overflow: hidden;
    flex-shrink: 0;
  }
  .s3d-tab-thumb img { width: 100%; height: 100%; object-fit: cover; }
  .s3d-tab-badge {
    position: absolute; bottom: 2px; right: 2px;
    display: flex; align-items: center; gap: 2px;
    padding: 1px 5px;
    background: var(--gold);
    color: #0a0608;
    font-size: 7px;
    font-weight: 800;
    letter-spacing: 0.5px;
    border-radius: 3px;
  }
  .s3d-tab-info { display: flex; flex-direction: column; gap: 3px; min-width: 0; }
  .s3d-tab-title {
    font-size: 12px;
    font-weight: 700;
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .s3d-tab-style {
    font-size: 10px;
    color: var(--muted2);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* ── Viewer wrap ──────────────────────────────────── */
  .s3d-viewer-wrap {
    position: relative;
    width: 100%;
    height: min(540px, 70vw);
    min-height: 320px;
    border-radius: 12px;
    overflow: hidden;
    background: #0e0c0d;
    border: 1px solid var(--border);
    box-shadow: 0 24px 80px rgba(0,0,0,0.7);
  }

  .s3d-canvas {
    position: absolute;
    inset: 0;
    width: 100% !important;
    height: 100% !important;
    display: block;
    touch-action: none;
  }

  /* Loading overlay */
  .s3d-loading {
    position: absolute; inset: 0;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 14px;
    background: rgba(14,12,13,0.85);
    z-index: 10;
    pointer-events: none;
  }
  .s3d-loading p { font-size: 12px; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; }
  .s3d-spinner {
    width: 36px; height: 36px;
    border: 2px solid rgba(185,138,55,0.2);
    border-top-color: var(--gold);
    border-radius: 50%;
    animation: spin 0.75s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Preview badge — bottom bar, non-intrusive */
  .s3d-placeholder {
    position: absolute;
    bottom: 12px; left: 12px;
    display: none;
    z-index: 8;
    pointer-events: none;
  }
  .s3d-placeholder-inner {
    background: rgba(14,12,13,0.78);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(185,138,55,0.30);
    border-radius: 6px;
    padding: 6px 12px;
  }
  .s3d-placeholder-title {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 10px;
    font-weight: 700;
    color: var(--gold);
    letter-spacing: 1px;
    text-transform: uppercase;
    white-space: nowrap;
  }

  /* Viewer UI (top right) */
  .s3d-ui {
    position: absolute;
    top: 14px; right: 14px;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
    z-index: 9;
    transition: opacity 0.3s;
  }
  .s3d-piece-name {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
    background: rgba(14,12,13,0.7);
    padding: 4px 10px;
    border-radius: 4px;
    backdrop-filter: blur(8px);
  }
  .s3d-actions { display: flex; gap: 6px; }
  .s3d-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px; height: 36px;
    background: rgba(14,12,13,0.75);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 6px;
    color: var(--muted);
    cursor: pointer;
    transition: background 0.15s, border-color 0.15s, color 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .s3d-btn:hover { background: rgba(185,138,55,0.15); border-color: var(--gold); color: var(--gold); }
  .s3d-btn--active { background: rgba(185,138,55,0.18); border-color: var(--gold); color: var(--gold); }

  /* ── CTA under viewer ─────────────────────────────── */
  .s3d-cta {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 24px;
  }
  .s3d-cta-text {
    font-size: 14px;
    color: var(--muted);
    flex: 1;
    min-width: 200px;
  }

  /* ── Bio / Gallery / CTA / Aftercare (same as before) */
  .bio-grid { display: grid; gap: 40px; }
  @media (min-width: 760px) { .bio-grid { grid-template-columns: 1fr 2fr; align-items: start; } }

  .gallery-section { background: #000; padding: 64px 0 0; }
  .artist-gallery-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-auto-rows: 220px;
    gap: 3px;
    margin-top: 24px;
  }
  .ag-item { position: relative; overflow: hidden; display: block; background: var(--dark); }
  .ag-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.6s, filter 0.4s; filter: brightness(0.85); }
  .ag-item:hover img { transform: scale(1.07); filter: brightness(0.65); }
  .ag-item--tall { grid-row: span 2; }
  .ag-overlay { position: absolute; inset: 0; display: flex; align-items: flex-end; justify-content: flex-end; padding: 12px; transition: background 0.3s; }
  .ag-overlay span { font-size: 16px; color: var(--gold); opacity: 0; transform: translateY(6px); transition: opacity 0.2s, transform 0.2s; }
  .ag-item:hover .ag-overlay { background: rgba(185,138,55,0.08); }
  .ag-item:hover .ag-overlay span { opacity: 1; transform: translateY(0); }
  @media (max-width: 640px) {
    .artist-gallery-grid { grid-template-columns: repeat(2, 1fr); grid-auto-rows: 160px; }
    .ag-item--tall { grid-row: span 1; }
  }

  .artist-cta-block { display: grid; gap: 28px; padding: 36px; background: var(--surface); }
  @media (min-width: 760px) { .artist-cta-block { grid-template-columns: 1fr auto; align-items: center; } }
  .artist-cta-btns { display: flex; flex-direction: column; gap: 10px; min-width: 180px; }
  .artist-cta-btns .btn { justify-content: center; }

  .aftercare-section { background: var(--dark); }
  .aftercare-grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
  .aftercare-num { font-family: var(--font-display); font-size: 48px; color: var(--border-gold); line-height: 1; margin-bottom: 8px; }
  .aftercare-card .h3 { margin-bottom: 8px; font-size: 20px; }
  .aftercare-card p { font-size: 14px; color: var(--muted); line-height: 1.65; }

  /* ── Fullscreen ─────────────────────────────────────── */
  .s3d-viewer-wrap:fullscreen {
    border-radius: 0;
    height: 100vh;
    width: 100vw;
    max-height: none;
  }
  .s3d-viewer-wrap:-webkit-full-screen {
    border-radius: 0;
    height: 100vh;
    width: 100vw;
  }

  /* ── Mobile ─────────────────────────────────────────── */
  @media (max-width: 480px) {
    .section-3d { padding: 48px 0 40px; }
    .s3d-viewer-wrap { height: 60vw; min-height: 260px; }
    .s3d-controls-hint { gap: 12px; }
    .s3d-controls-hint span { font-size: 9px; }
  }
</style>
